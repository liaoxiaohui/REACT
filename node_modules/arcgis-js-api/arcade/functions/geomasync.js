// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.8/esri/copyright.txt for details.

define(["require","exports","dojo/Deferred","../../kernel","../kernel","../languageUtils","./centroid","../../geometry/Extent","../../geometry/Geometry","../../geometry/geometryEngineAsync","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../geometry/support/jsonUtils"],function(e,n,r,t,o,u,i,l,a,f,c,s,g,m,d){function h(e){return y?e.clone():d.fromJSON(e.toJSON())}function w(e){return 0===t.version.indexOf("4.")?g.fromExtent(e):new g({spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]})}function p(e){if(u.pcCheck(e,2,2),e[0]instanceof a&&e[1]instanceof a);else if(e[0]instanceof a&&null===e[1]);else if(e[1]instanceof a&&null===e[0]);else if(null!==e[0]||null!==e[1])throw new Error("Illegal Argument")}function C(e,n,t){e.disjoint=function(e,n){return t(e,n,function(e,n,r){return r=u.autoCastFeatureToGeometry(r),p(r),null===r[0]||null===r[1]||f.disjoint(r[0],r[1])})},e.intersects=function(e,n){return t(e,n,function(e,n,r){return r=u.autoCastFeatureToGeometry(r),p(r),null!==r[0]&&null!==r[1]&&f.intersects(r[0],r[1])})},e.touches=function(e,n){return t(e,n,function(e,n,r){return r=u.autoCastFeatureToGeometry(r),p(r),null!==r[0]&&null!==r[1]&&f.touches(r[0],r[1])})},e.crosses=function(e,n){return t(e,n,function(e,n,r){return r=u.autoCastFeatureToGeometry(r),p(r),null!==r[0]&&null!==r[1]&&f.crosses(r[0],r[1])})},e.within=function(e,n){return t(e,n,function(e,n,r){return r=u.autoCastFeatureToGeometry(r),p(r),null!==r[0]&&null!==r[1]&&f.within(r[0],r[1])})},e.contains=function(e,n){return t(e,n,function(e,n,r){return r=u.autoCastFeatureToGeometry(r),p(r),null!==r[0]&&null!==r[1]&&f.contains(r[0],r[1])})},e.overlaps=function(e,n){return t(e,n,function(e,n,r){return r=u.autoCastFeatureToGeometry(r),p(r),null!==r[0]&&null!==r[1]&&f.overlaps(r[0],r[1])})},e.equals=function(e,n){return t(e,n,function(e,n,r){return u.pcCheck(r,2,2),r[0]===r[1]||(r[0]instanceof a&&r[1]instanceof a?f.equals(r[0],r[1]):!(!u.isDate(r[0])||!u.isDate(r[1]))&&r[0].getTime()===r[1].getTime())})},e.relate=function(e,n){return t(e,n,function(e,n,r){if(r=u.autoCastFeatureToGeometry(r),u.pcCheck(r,3,3),r[0]instanceof a&&r[1]instanceof a)return f.relate(r[0],r[1],u.toString(r[2]));if(r[0]instanceof a&&null===r[1])return!1;if(r[1]instanceof a&&null===r[0])return!1;if(null===r[0]&&null===r[1])return!1;throw new Error("Illegal Argument")})},e.intersection=function(e,n){return t(e,n,function(e,n,r){return r=u.autoCastFeatureToGeometry(r),p(r),null===r[0]||null===r[1]?null:f.intersect(r[0],r[1])})},e.union=function(e,n){return t(e,n,function(n,r,t){t=u.autoCastFeatureToGeometry(t);var o=[];if(0===t.length)throw new Error("Function called with wrong number of Parameters");if(1===t.length)if(u.isArray(t[0])){for(var i=u.autoCastFeatureToGeometry(t[0]),l=0;l<i.length;l++)if(null!==i[l]){if(!(i[l]instanceof a))throw new Error("Illegal Argument");o.push(i[l])}}else{if(!u.isImmutableArray(t[0])){if(t[0]instanceof a)return u.fixSpatialReference(h(t[0]),e.spatialReference);if(null===t[0])return null;throw new Error("Illegal Argument")}for(var c=u.autoCastFeatureToGeometry(t[0].toArray()),l=0;l<c.length;l++)if(null!==c[l]){if(!(c[l]instanceof a))throw new Error("Illegal Argument");o.push(c[l])}}else for(var l=0;l<t.length;l++)if(null!==t[l]){if(!(t[l]instanceof a))throw new Error("Illegal Argument");o.push(t[l])}return 0===o.length?null:f.union(o)})},e.difference=function(e,n){return t(e,n,function(e,n,r){return r=u.autoCastFeatureToGeometry(r),p(r),null!==r[0]&&null===r[1]?h(r[0]):null===r[0]?null:f.difference(r[0],r[1])})},e.symmetricdifference=function(e,n){return t(e,n,function(e,n,r){return r=u.autoCastFeatureToGeometry(r),p(r),null===r[0]&&null===r[1]?null:null===r[0]?h(r[1]):null===r[1]?h(r[0]):f.symmetricDifference(r[0],r[1])})},e.clip=function(e,n){return t(e,n,function(e,n,r){if(r=u.autoCastFeatureToGeometry(r),u.pcCheck(r,2,2),!(r[1]instanceof l)&&null!==r[1])throw new Error("Illegal Argument");if(null===r[0])return null;if(!(r[0]instanceof a))throw new Error("Illegal Argument");return null===r[1]?null:f.clip(r[0],r[1])})},e.cut=function(e,n){return t(e,n,function(e,n,r){if(r=u.autoCastFeatureToGeometry(r),u.pcCheck(r,2,2),!(r[1]instanceof m)&&null!==r[1])throw new Error("Illegal Argument");if(null===r[0])return[];if(!(r[0]instanceof a))throw new Error("Illegal Argument");return null===r[1]?[h(r[0])]:f.cut(r[0],r[1])})},e.area=function(e,n){return t(e,n,function(e,n,r){if(r=u.autoCastFeatureToGeometry(r),u.pcCheck(r,1,2),null===r[0])return 0;if(!(r[0]instanceof a))throw new Error("Illegal Argument");return f.planarArea(r[0],o.convertSquareUnitsToCode(u.defaultUndefined(r[1],-1)))})},e.areageodetic=function(e,n){return t(e,n,function(e,n,r){if(r=u.autoCastFeatureToGeometry(r),u.pcCheck(r,1,2),null===r[0])return 0;if(!(r[0]instanceof a))throw new Error("Illegal Argument");return f.geodesicArea(r[0],o.convertSquareUnitsToCode(u.defaultUndefined(r[1],-1)))})},e.length=function(e,n){return t(e,n,function(e,n,r){if(r=u.autoCastFeatureToGeometry(r),u.pcCheck(r,1,2),null===r[0])return 0;if(!(r[0]instanceof a))throw new Error("Illegal Argument");return f.planarLength(r[0],o.convertLinearUnitsToCode(u.defaultUndefined(r[1],-1)))})},e.lengthgeodetic=function(e,n){return t(e,n,function(e,n,r){if(r=u.autoCastFeatureToGeometry(r),u.pcCheck(r,1,2),null===r[0])return 0;if(!(r[0]instanceof a))throw new Error("Illegal Argument");return f.geodesicLength(r[0],o.convertLinearUnitsToCode(u.defaultUndefined(r[1],-1)))})},e.distance=function(e,n){return t(e,n,function(e,n,r){if(r=u.autoCastFeatureToGeometry(r),u.pcCheck(r,2,3),!(r[0]instanceof a))throw new Error("Illegal Argument");if(!(r[1]instanceof a))throw new Error("Illegal Argument");return f.distance(r[0],r[1],o.convertLinearUnitsToCode(u.defaultUndefined(r[2],-1)))})},e.densify=function(e,n){return t(e,n,function(e,n,r){if(r=u.autoCastFeatureToGeometry(r),u.pcCheck(r,2,3),null===r[0])return null;if(!(r[0]instanceof a))throw new Error("Illegal Argument");var t=u.toNumber(r[1]);if(isNaN(t))throw new Error("Illegal Argument");if(t<=0)throw new Error("Illegal Argument");return r[0]instanceof g||r[0]instanceof m?f.densify(r[0],t,o.convertLinearUnitsToCode(u.defaultUndefined(r[2],-1))):r[0]instanceof l?f.densify(w(r[0]),t,o.convertLinearUnitsToCode(u.defaultUndefined(r[2],-1))):r[0]})},e.densifygeodetic=function(e,n){return t(e,n,function(e,n,r){if(r=u.autoCastFeatureToGeometry(r),u.pcCheck(r,2,3),null===r[0])return null;if(!(r[0]instanceof a))throw new Error("Illegal Argument");var t=u.toNumber(r[1]);if(isNaN(t))throw new Error("Illegal Argument");if(t<=0)throw new Error("Illegal Argument");return r[0]instanceof g||r[0]instanceof m?f.geodesicDensify(r[0],t,o.convertLinearUnitsToCode(u.defaultUndefined(r[2],-1))):r[0]instanceof l?f.geodesicDensify(w(r[0]),t,o.convertLinearUnitsToCode(u.defaultUndefined(r[2],-1))):r[0]})},e.generalize=function(e,n){return t(e,n,function(e,n,r){if(r=u.autoCastFeatureToGeometry(r),u.pcCheck(r,2,4),null===r[0])return null;if(!(r[0]instanceof a))throw new Error("Illegal Argument");var t=u.toNumber(r[1]);if(isNaN(t))throw new Error("Illegal Argument");return f.generalize(r[0],t,u.toBoolean(u.defaultUndefined(r[2],!0)),o.convertLinearUnitsToCode(u.defaultUndefined(r[3],-1)))})},e.buffer=function(e,n){return t(e,n,function(e,n,r){if(r=u.autoCastFeatureToGeometry(r),u.pcCheck(r,2,3),null===r[0])return null;if(!(r[0]instanceof a))throw new Error("Illegal Argument");var t=u.toNumber(r[1]);if(isNaN(t))throw new Error("Illegal Argument");return 0===t?h(r[0]):f.buffer(r[0],t,o.convertLinearUnitsToCode(u.defaultUndefined(r[2],-1)))})},e.buffergeodetic=function(e,n){return t(e,n,function(e,n,r){if(r=u.autoCastFeatureToGeometry(r),u.pcCheck(r,2,3),null===r[0])return null;if(!(r[0]instanceof a))throw new Error("Illegal Argument");var t=u.toNumber(r[1]);if(isNaN(t))throw new Error("Illegal Argument");return 0===t?h(r[0]):f.geodesicBuffer(r[0],t,o.convertLinearUnitsToCode(u.defaultUndefined(r[2],-1)))})},e.offset=function(e,n){return t(e,n,function(e,n,r){if(r=u.autoCastFeatureToGeometry(r),u.pcCheck(r,2,6),null===r[0])return null;if(!(r[0]instanceof g||r[0]instanceof m))throw new Error("Illegal Argument");var t=u.toNumber(r[1]);if(isNaN(t))throw new Error("Illegal Argument");var i=u.toNumber(u.defaultUndefined(r[4],10));if(isNaN(i))throw new Error("Illegal Argument");var l=u.toNumber(u.defaultUndefined(r[5],0));if(isNaN(l))throw new Error("Illegal Argument");return f.offset(r[0],t,o.convertLinearUnitsToCode(u.defaultUndefined(r[2],-1)),u.toString(u.defaultUndefined(r[3],"round")).toLowerCase(),i,l)})},e.rotate=function(e,n){return t(e,n,function(e,n,r){r=u.autoCastFeatureToGeometry(r),u.pcCheck(r,2,3);var t=r[0];if(null===t)return null;if(!(t instanceof a))throw new Error("Illegal Argument");t instanceof l&&(t=g.fromExtent(t));var o=u.toNumber(r[1]);if(isNaN(o))throw new Error("Illegal Argument");var i=u.defaultUndefined(r[2],null);if(null===i)return f.rotate(t,o);if(i instanceof s)return f.rotate(t,o,i);throw new Error("Illegal Argument")})},e.centroid=function(e,n){return t(e,n,function(n,r,t){if(t=u.autoCastFeatureToGeometry(t),u.pcCheck(t,1,1),null===t[0])return null;if(!(t[0]instanceof a))throw new Error("Illegal Argument");return t[0]instanceof s?u.fixSpatialReference(h(t[0]),e.spatialReference):t[0]instanceof g?y?t[0].centroid:t[0].getCentroid():t[0]instanceof m?i.centroidPolyline(t[0]):t[0]instanceof c?i.centroidMultiPoint(t[0]):t[0]instanceof l?y?t[0].center:t[0].getExtent().getCenter():null})},e.multiparttosinglepart=function(e,n){return t(e,n,function(n,t,i){i=u.autoCastFeatureToGeometry(i),u.pcCheck(i,1,1);var w=[];if(null===i[0])return null;if(!(i[0]instanceof a))throw new Error("Illegal Argument");if(i[0]instanceof s)return[u.fixSpatialReference(h(i[0]),e.spatialReference)];if(i[0]instanceof l)return[u.fixSpatialReference(h(i[0]),e.spatialReference)];var p=new r;return f.simplify(i[0]).then(o.callback(function(n){if(n instanceof g){for(var r=[],t=[],o=0;o<n.rings.length;o++)if(n.isClockwise(n.rings[o])){var l=d.fromJSON({rings:[n.rings[o]],hasZ:!!y&&n.hasZ,hazM:!!y&&n.hasM,spatialReference:y?n.spatialReference.toJSON():n.spatialReference.toJson()});r.push(l)}else t.push({ring:n.rings[o],pt:n.getPoint(o,0)});for(var a=0;a<t.length;a++)for(var f=0;f<r.length;f++)if(r[f].contains(t[a].pt)){r[f].addRing(t[a].ring);break}p.resolve(r)}else if(n instanceof m){for(var s=[],o=0;o<n.paths.length;o++){var C=d.fromJSON({paths:[n.paths[o]],hasZ:!!y&&n.hasZ,hazM:!!y&&n.hasM,spatialReference:y?n.spatialReference.toJSON():n.spatialReference.toJson()});s.push(C)}p.resolve(s)}else if(i[0]instanceof c){for(var v=u.fixSpatialReference(h(i[0]),e.spatialReference),o=0;o<v.points.length;o++)w.push(v.getPoint(o));p.resolve(w)}else p.resolve(null)},p),o.errback(p)),p.promise})},e.issimple=function(e,n){return t(e,n,function(e,n,r){if(r=u.autoCastFeatureToGeometry(r),u.pcCheck(r,1,1),null===r[0])return!0;if(r[0]instanceof a)return f.isSimple(r[0]);throw new Error("Illegal Argument")})},e.simplify=function(e,n){return t(e,n,function(e,n,r){if(r=u.autoCastFeatureToGeometry(r),u.pcCheck(r,1,1),null===r[0])return null;if(r[0]instanceof a)return f.simplify(r[0]);throw new Error("Illegal Argument")})}}Object.defineProperty(n,"__esModule",{value:!0});var y=0===t.version.indexOf("4.");n.registerFunctions=C});