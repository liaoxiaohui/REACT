// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.8/esri/copyright.txt for details.

define(["require","exports","../Point","../Polygon","../Polyline","../SpatialReference"],function(e,t,a,r,s,i){function n(e,t,r,s){for(var n,h,o,M,c=6378137,l=6356752.31424518,u=1/298.257223563,v=Math.sin(r),f=Math.cos(r),p=(1-u)*Math.tan(e),g=1/Math.sqrt(1+p*p),d=p*g,y=Math.atan2(p,f),q=g*v*(g*v),m=1-q,S=m*(c*c-l*l)/(l*l),P=1+S/16384*(4096+S*(S*(320-175*S)-768)),D=S/1024*(256+S*(S*(74-47*S)-128)),w=s/(l*P),I=2*Math.PI;Math.abs(w-I)>1e-12;)o=Math.cos(2*y+w),n=Math.sin(w),h=Math.cos(w),M=D*n*(o+D/4*(h*(2*o*o-1)-D/6*o*(4*n*n-3)*(4*o*o-3))),I=w,w=s/(l*P)+M;var x=d*n-g*h*f,R=Math.atan2(d*h+g*n*f,(1-u)*Math.sqrt(q+x*x)),z=Math.atan2(n*v,g*h-d*n*f),A=u/16*m*(4+u*(4-3*m)),b=z-(1-A)*u*Math.sqrt(q)*(w+A*n*(o+A*h*(2*o*o-1))),N=R/(Math.PI/180),_=(t+b)/(Math.PI/180);return new a(_,N,new i({wkid:4326}))}function h(e,t,a,r){var s,i,n,h,o,M,c,l,u,v,f=6378137,p=6356752.31424518,g=1/298.257223563,d=r-t,y=Math.atan((1-g)*Math.tan(e)),q=Math.atan((1-g)*Math.tan(a)),m=Math.sin(y),S=Math.cos(y),P=Math.sin(q),D=Math.cos(q),w=1e3,I=d;do{if(c=Math.sin(I),l=Math.cos(I),0===(n=Math.sqrt(D*c*(D*c)+(S*P-m*D*l)*(S*P-m*D*l))))return{geodesicDistance:0};o=m*P+S*D*l,M=Math.atan2(n,o),u=S*D*c/n,i=1-u*u,h=o-2*m*P/i,isNaN(h)&&(h=0),v=g/16*i*(4+g*(4-3*i)),s=I,I=d+(1-v)*g*u*(M+v*n*(h+v*o*(2*h*h-1)))}while(Math.abs(I-s)>1e-12&&--w>0);if(0===w){var x=6371009*Math.acos(Math.sin(e)*Math.sin(a)+Math.cos(e)*Math.cos(a)*Math.cos(r-t)),R=r-t,z=Math.sin(R)*Math.cos(a),A=Math.cos(e)*Math.sin(a)-Math.sin(e)*Math.cos(a)*Math.cos(R);return{geodesicDistance:x,azimuth:Math.atan2(z,A)}}var b=i*(f*f-p*p)/(p*p),N=1+b/16384*(4096+b*(b*(320-175*b)-768)),_=b/1024*(256+b*(b*(74-47*b)-128));return{geodesicDistance:p*N*(M-_*n*(h+_/4*(o*(2*h*h-1)-_/6*h*(4*n*n-3)*(4*h*h-3)))),azimuth:Math.atan2(D*Math.sin(I),S*P-m*D*Math.cos(I)),reverseAzimuth:Math.atan2(S*Math.sin(I),S*P*Math.cos(I)-m*D)}}function o(e,t){var a=Math.PI/180;if(t<637.100877151506&&(t=637.100877151506),"polyline"!==e.type&&"polygon"!==e.type){var i="_geodesicDensify: the input geometry is neither polyline nor polygon";throw console.error(i),new Error(i)}for(var o="polyline"===e.type?e.paths:e.rings,M=[],c=0,l=o;c<l.length;c++){var u=l[c],v=[];M.push(v),v.push([u[0][0],u[0][1]]);for(var f=u[0][0]*a,p=u[0][1]*a,g=void 0,d=void 0,y=0;y<u.length-1;y++)if(g=u[y+1][0]*a,d=u[y+1][1]*a,f!==g||p!==d){var q=h(p,f,d,g),m=q.azimuth,S=q.geodesicDistance,P=S/t;if(P>1){for(var D=1;D<=P-1;D++){var w=D*t,I=n(p,f,m,w);v.push([I.x,I.y])}var x=(S+Math.floor(P-1)*t)/2,R=n(p,f,m,x);v.push([R.x,R.y])}var z=n(p,f,m,S);v.push([z.x,z.y]),f=z.x*a,p=z.y*a}}return"polyline"===e.type?new s({paths:M,spatialReference:e.spatialReference}):new r({rings:M,spatialReference:e.spatialReference})}function M(e,t){for(var a=Math.PI/180,r=[],s=0;s<e.length;s++){for(var i=e[s].paths,n=0,o=0;o<i.length;o++){for(var M=i[o],c=0,l=1;l<M.length;l++){var v=M[l-1][0]*a,f=M[l][0]*a,p=M[l-1][1]*a,g=M[l][1]*a;if(p!==g||v!==f){c+=h(p,v,g,f).geodesicDistance/1609.344}}n+=c}n*=u[t],r.push(n)}return r}function c(e,t){for(var a=[],r=0;r<e.length;r++){var s=e[r],i=o(s,1e4);a.push(i)}for(var n=[],h=0;h<a.length;h++){for(var M=a[h].rings,c=0,p=0;p<M.length;p++){var g=M[p];l(v,g[0]),l(f,g[g.length-1]);for(var d=f[0]*v[1]-v[0]*f[1],y=0;y<g.length-1;y++)l(v,g[y+1]),l(f,g[y]),d+=f[0]*v[1]-v[0]*f[1];d/=4046.87,c+=d}c*=u[t],n.push(c/-2)}return n}function l(e,t){var a=Math.PI/180,r=6378137,s=.006694379990197414,i=.0818191908429643,n=Math.sin(t[1]*a),h=(1-s)*(n/(1-s*(n*n))-1/(2*i)*Math.log((1-i*n)/(1+i*n))),o=r*t[0]*a,M=r*h*.5;return e[0]=o,e[1]=M,e}Object.defineProperty(t,"__esModule",{value:!0});var u={esriMiles:1,esriKilometers:1.609344,esriFeet:5280,esriMeters:1609.34,esriYards:1760,esriNauticalMiles:.869,esriCentimeters:160934,esriDecimeters:16093.4,esriInches:63360,esriMillimeters:1609340,esriAcres:1,esriAres:40.4685642,esriSquareKilometers:.00404685642,esriSquareMiles:.0015625,esriSquareFeet:43560,esriSquareMeters:4046.85642,esriHectares:.404685642,esriSquareYards:4840,esriSquareInches:6272640,esriSquareMillimeters:4046856420,esriSquareCentimeters:40468564.2,esriSquareDecimeters:404685.642};t.directGeodeticSolver=n,t.inverseGeodeticSolver=h,t.geodesicDensify=o,t.geodesicLengths=M;var v=[0,0],f=[0,0];t.geodesicAreas=c});