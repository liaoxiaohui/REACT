// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.8/esri/copyright.txt for details.

define(["require","exports","../../../core/tsSupport/assignHelper","../../../core/tsSupport/declareExtendsHelper","../../../core/tsSupport/decorateHelper","dojo/dom-construct","dojo/i18n!../nls/SymbolStyler","../../../Color","../../../symbols","../../../core/Accessor","../../../core/promiseUtils","../../../core/urlUtils","../../../core/accessorSupport/decorators","../../../symbols/support/gfxUtils","../../../symbols/support/jsonUtils","../../../symbols/support/styleUtils","../../../symbols/support/symbolPreview"],function(t,e,r,o,i,n,a,l,s,p,y,m,u,c,d,h,v){function b(t){var e=t.get("data.thumbnail.href"),r=t.data.title,o=n.create("div");if(!e)return o.appendChild(S(r)),y.resolve(o);var i=new s.WebStyleSymbol({name:t.data.name,styleUrl:t.portalItem.url+"/data",thumbnail:{url:e?m.makeAbsolute(e,t.get("portalItem.itemUrl")):null}}),a="flat"===t.data.dimensionality?24:48;return v.renderPreviewHTML(i,{node:o,size:a,disableUpsampling:!0}).then(function(t){return o}).catch(function(){return o.appendChild(S(r)),o})}function S(t){return void 0===t&&(t=a.noTitle),n.create("span",{innerHTML:t,alt:""})}function f(t,e,r){var o=h.styleNameFromItem(r),i=null;o||(i=r.itemUrl+"/data");var n={data:t,baseUrl:r.itemUrl,styleName:o,styleUrl:i};return h.fetchSymbolFromStyle(n,e,{portal:r.portal})}Object.defineProperty(e,"__esModule",{value:!0});var g=[{name:"Circle",type:"esriSMS",style:"esriSMSCircle",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Square",type:"esriSMS",style:"esriSMSSquare",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Diamond",type:"esriSMS",style:"esriSMSDiamond",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Cross",type:"esriSMS",style:"esriSMSCross",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"X",type:"esriSMS",style:"esriSMSX",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}}],w=[{name:a.circle,primitive:"circle"},{name:a.square,primitive:"square"},{name:a.cross,primitive:"cross"},{name:a.x,primitive:"x"},{name:a.kite,primitive:"kite"}],I=[{name:a.sphere,primitive:"sphere"},{name:a.tallCylinder,primitive:"cylinder",mixins:{width:5,height:10,depth:5}},{name:a.cylinder,primitive:"cylinder"},{name:a.tallCube,primitive:"cube",mixins:{width:5,height:10,depth:5,anchor:"bottom"}},{name:a.cube,primitive:"cube"},{name:a.tallCone,primitive:"cone",mixins:{width:5,height:10,depth:5}},{name:a.cone,primitive:"cone"},{name:a.invertedCone,primitive:"inverted-cone"},{name:a.diamond,primitive:"diamond"},{name:a.tetrahedron,primitive:"tetrahedron"}],_=w.map(function(t){return{dimensionality:"flat",title:t.name,type:"PointSymbol3D",symbolLayers:[{type:"Icon",resource:{primitive:t.primitive},material:{color:c.defaultThematicColor},outline:{color:[0,0,0]}}]}}),C=I.map(function(t){return{dimensionality:"volumetric",title:t.name,type:"PointSymbol3D",symbolLayers:[r({type:"Object",resource:{primitive:t.primitive}},t.mixins)]}}),M={getSymbol:function(t){var e=t.data,r=t.parentData,o=t.portalItem;return f(r,e.name,o).then(function(t){return"point-3d"===t.type&&t.symbolLayers.forEach(function(t){t.get("material.color")&&("icon"===t.type?t.material.color=c.defaultThematicColor.clone():"object"===t.type&&(t.material.color=t.material.color||new l([255,255,255])))}),t})},getThumbnail:function(t){return b(t)}},O={getSymbol:function(t){return y.resolve(d.fromJSON(t.data))},getThumbnail:function(t){return t.getSymbol().then(function(t){return v.renderPreviewHTML(t,{size:24})})}},P={getSymbol:function(t){return y.resolve(d.fromJSON(t.data))},getThumbnail:function(t){return t.getSymbol().then(function(t){return v.renderPreviewHTML(t,{size:48})})}},T=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.getSymbol=function(){var t=this;return this._symbol?y.resolve(this._symbol):this.strategy.getSymbol(this).then(function(e){return t._symbol=e})},e.prototype.getThumbnail=function(t){var e=this;return this._thumbnail?(t.appendChild(this._thumbnail),y.resolve()):this.strategy.getThumbnail(this).then(function(r){e._thumbnail=r,t.appendChild(e._thumbnail)})},i([u.property()],e.prototype,"strategy",void 0),i([u.property()],e.prototype,"data",void 0),i([u.property()],e.prototype,"parentData",void 0),i([u.property()],e.prototype,"portalItem",void 0),e=i([u.subclass("esri.widgets.SymbolStyler.SymbolItem")],e)}(u.declared(p));e.SymbolItem=T;var U=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.fetchData=function(){var t=this;return this.data?y.resolve(this.data):this.portalItem.fetchData().then(function(e){return t._set("data",e),e})},i([u.property({readOnly:!0})],e.prototype,"data",void 0),i([u.property({aliasOf:"portalItem.id"})],e.prototype,"id",void 0),i([u.property({aliasOf:"portalItem.name"})],e.prototype,"name",void 0),i([u.property({aliasOf:"portalItem.title"})],e.prototype,"title",void 0),i([u.property()],e.prototype,"portalItem",void 0),e=i([u.subclass("esri.widgets.SymbolStyler.PortalItemSymbolSourceBase")],e)}(u.declared(p)),D=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="symbol-set",e}return o(e,t),e.prototype.getItems=function(){return y.resolve(null)},i([u.property({readOnly:!0})],e.prototype,"type",void 0),e=i([u.subclass("esri.widgets.SymbolStyler.SymbolSetSymbolSource")],e)}(u.declared(U));e.SymbolSetSymbolSource=D;var x=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="web-style",e}return o(e,t),e.prototype.getItems=function(){var t=this;return this._items?y.resolve(this._items):this.fetchData().then(function(e){return e.items.map(function(r){return new T({data:r,parentData:e,portalItem:t.portalItem,strategy:M})})}).then(function(e){return t._items=e})},i([u.property({readOnly:!0})],e.prototype,"type",void 0),e=i([u.subclass("esri.widgets.SymbolStyler.WebStyleSymbolSource")],e)}(u.declared(U));e.WebStyleSymbolSource=x;var j=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=g,e.id="basic-symbol-set",e.name="Basic",e.title=a.basic,e.type="symbol-set",e}return o(e,t),e.prototype.getItems=function(){return y.resolve(null)},i([u.property()],e.prototype,"data",void 0),i([u.property()],e.prototype,"id",void 0),i([u.property()],e.prototype,"name",void 0),i([u.property()],e.prototype,"title",void 0),i([u.property({readOnly:!0})],e.prototype,"type",void 0),e=i([u.subclass("esri.widgets.SymbolStyler.BasicSymbolSetSource")],e)}(u.declared(p));e.BasicSymbolSetSource=j;var z=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data={items:_},e.id="basic-web-style:flat",e.name="Basic",e.title=a.basic,e.type="web-style",e}return o(e,t),e.prototype.getItems=function(){if(this._items)return y.resolve(this._items);var t=this.data.items.map(function(t){return new T({data:t,strategy:O})});return y.resolve(this._items=t)},i([u.property()],e.prototype,"data",void 0),i([u.property()],e.prototype,"id",void 0),i([u.property()],e.prototype,"name",void 0),i([u.property()],e.prototype,"title",void 0),i([u.property({readOnly:!0})],e.prototype,"type",void 0),e=i([u.subclass("esri.widgets.SymbolStyler.IconPrimitiveWebStyleSource")],e)}(u.declared(p));e.IconPrimitiveWebStyleSource=z;var H=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data={items:C},e.id="basic-web-style:volumetric",e.name="Basic",e.title=a.basic,e.type="web-style",e}return o(e,t),e.prototype.getItems=function(){var t=this;if(this._items)return y.resolve(this._items);var e=this.data.items.map(function(e){return new T({data:e,parentData:t.data,strategy:P})});return y.resolve(this._items=e)},i([u.property()],e.prototype,"data",void 0),i([u.property()],e.prototype,"id",void 0),i([u.property()],e.prototype,"name",void 0),i([u.property()],e.prototype,"title",void 0),i([u.property({readOnly:!0})],e.prototype,"type",void 0),e=i([u.subclass("esri.widgets.SymbolStyler.ObjectPrimitiveWebStyleSource")],e)}(u.declared(p));e.ObjectPrimitiveWebStyleSource=H});